# Quland CMS — Analytics & Third-Party Integrations

## 1. Google Analytics

### Configuration

| Setting Key | Description |
|-------------|-------------|
| `google_analytics_id` | GA Tracking ID (e.g., `UA-XXXXXXX-X` or `G-XXXXXXX`) |
| `google_analytics_status` | Enable/disable (1/0) |

### Frontend Injection

In the theme layout `<head>`:
```blade
@if($settings['google_analytics_status'] ?? false)
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ $settings['google_analytics_id'] }}"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '{{ $settings['google_analytics_id'] }}');
    </script>
@endif
```

## 2. Facebook Pixel

### Configuration

| Setting Key | Description |
|-------------|-------------|
| `facebook_pixel_id` | Facebook Pixel ID |
| `facebook_pixel_status` | Enable/disable (1/0) |

### Frontend Injection

```blade
@if($settings['facebook_pixel_status'] ?? false)
    <script>
        !function(f,b,e,v,n,t,s){...}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '{{ $settings['facebook_pixel_id'] }}');
        fbq('track', 'PageView');
    </script>
@endif
```

## 3. Tawk.to Live Chat

### Configuration

| Setting Key | Description |
|-------------|-------------|
| `tawk_chat_id` | Tawk.to Property ID |
| `tawk_chat_status` | Enable/disable (1/0) |

### Frontend Injection

```blade
@if($settings['tawk_chat_status'] ?? false)
    <script type="text/javascript">
        var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
        (function(){
            var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
            s1.async=true;
            s1.src='https://embed.tawk.to/{{ $settings['tawk_chat_id'] }}';
            s1.charset='UTF-8';
            s0.parentNode.insertBefore(s1,s0);
        })();
    </script>
@endif
```

## 4. Google reCAPTCHA v2

### Configuration

| Setting Key | Description |
|-------------|-------------|
| `recaptcha_site_key` | Site key (public) |
| `recaptcha_secret_key` | Secret key (server-side) |
| `recaptcha_status` | Enable/disable (1/0) |

### Package

`google/recaptcha ^1.3`

### Frontend Rendering

```blade
@if($settings['recaptcha_status'] ?? false)
    <div class="g-recaptcha" data-sitekey="{{ $settings['recaptcha_site_key'] }}"></div>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
@endif
```

### Server-Side Validation

**File:** `app/Rules/Captcha.php`

```php
public function validate(string $attribute, mixed $value, Closure $fail): void
{
    $google_recaptcha = GlobalSetting::where('key', 'recaptcha_secret_key')->first();
    $recaptcha = new ReCaptcha($google_recaptcha->value);
    $response = $recaptcha->verify($value, $_SERVER['REMOTE_ADDR']);
    if (!$response->isSuccess()) {
        $fail('Please complete the recaptcha to submit the form');
    }
}
```

### Applied To

- User login form
- User registration form
- Password reset form
- Blog comment form
- Contact form

## 5. Cookie Consent

### Configuration

| Setting Key | Description |
|-------------|-------------|
| `cookie_status` | Enable/disable (1/0) |
| `cookie_text` | Consent message text |
| `cookie_button_text` | Accept button label |

### Frontend Display

Cookie consent banner shown on first visit, accepted status stored in cookie/localStorage.

## 6. Progressive Web App (PWA)

### Package

`silviolleite/laravelpwa` configured via `config/laravelpwa.php`.

### Files

- `public/serviceworker.js` — Service worker for offline caching
- PWA manifest generated by the package

## 7. Admin Configuration Routes

All integrations configured via:
```
GET  /admin/analytics-setting       → Google Analytics form
POST /admin/analytics-setting-update → Save
GET  /admin/pixel-setting           → Facebook Pixel form
POST /admin/pixel-setting-update    → Save
GET  /admin/tawk-setting            → Tawk.to form
POST /admin/tawk-setting-update     → Save
GET  /admin/recaptcha-setting       → reCAPTCHA form
POST /admin/recaptcha-setting-update → Save
GET  /admin/cookie-setting          → Cookie consent form
POST /admin/cookie-setting-update   → Save
```
